---
feature: tool-logger
created: 2026-02-07
status: draft
---

# 구현 계획: tool-logger

> PostToolUse 훅 — 도구 사용 기록 및 해결 감지

---

## 개요

`hooks/tool-logger.mjs`는 도구 성공 실행 시 트리거되는 훅 스크립트이다. 도구별 메타데이터를 추출하여 기록하고, 이전 에러가 해결되었는지 감지하여 에러 KB에 해결 이력을 기록한다.

---

## 기술 결정

### 결정 1: Bash 명령어 첫 단어만 저장

**근거:** 프라이버시 보호 — 명령어 인자에 비밀 키, 경로 등 민감 정보 포함 가능

**대안 검토:**
- 전체 명령어 저장 — 패턴 분석에 유리하나 보안 위험
- 해시 저장 — 비가역적이라 분석 활용 불가

### 결정 2: 최근 100개 엔트리 기반 해결 감지

**근거:** 전체 파일 스캔 대비 성능 최적화. 세션 내 해결은 대부분 최근 이벤트에서 발생

---

## 구현 단계

### Phase 1: 스캐폴드

훅 스크립트 파일 및 의존성 설정

**산출물:**
- [ ] `~/.self-generation/hooks/tool-logger.mjs` 파일 생성
- [ ] db.mjs, error-kb.mjs import 설정

### Phase 2: 핵심 로직

도구 기록, 메타 추출, 해결 감지 구현

**산출물:**
- [ ] ToolUseEntry 스키마로 도구 사용 기록
- [ ] `extractToolMeta()` — 7개 도구 유형별 메타데이터 추출
- [ ] 동일 도구 해결 감지 (same-tool resolution)
- [ ] 크로스 도구 해결 감지 (cross-tool resolution)
- [ ] try-catch 이중 래퍼 (외부: 전체, 내부: 해결 감지)

### Phase 3: 테스트

시나리오 기반 테스트

**산출물:**
- [ ] extractToolMeta 각 도구 유형별 테스트
- [ ] Bash 첫 단어 추출 검증
- [ ] 동일 도구 해결 감지 시나리오
- [ ] 크로스 도구 해결 감지 시나리오
- [ ] 해결 감지 실패 시 도구 기록 정상 완료 검증

---

## 리스크 분석

| 리스크 | 영향도 | 완화 전략 |
|--------|--------|----------|
| 해결 감지 오탐 | MEDIUM | 세션 스코프 제한으로 관련 없는 에러 배제 |
| queryEvents 100개 성능 | LOW | SQL LIMIT/ORDER BY 최적화 |
| error-kb.mjs 부재 (Phase 1) | LOW | import 실패 시 해결 감지 비활성화 |

---

## 테스트 전략

### 단위 테스트

- extractToolMeta 함수 독립 테스트
- 해결 감지 로직 mock 데이터 테스트
- 커버리지 목표: 80% 이상

### 통합 테스트

- 에러 → 성공 시퀀스 시뮬레이션
- `error_kb` 테이블 기록 결과 확인

---

## 다음 단계

1. [ ] 이 계획에 대한 검토 및 승인
2. [ ] 작업 분해 (tasks.md)
3. [ ] 구현 시작
